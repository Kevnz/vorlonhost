var VORLON;!function(e){var t=function(){function e(){}return e.QuerySelectorById=function(e,t){return e.querySelector?e.querySelector("#"+t):document.getElementById(t)},e.SetImmediate=function(e){window.setImmediate?setImmediate(e):setTimeout(e,0)},e.setLocalStorageValue=function(e,t){if(localStorage)try{localStorage.setItem(e,t)}catch(n){}},e.getLocalStorageValue=function(e){if(localStorage)try{return localStorage.getItem(e)}catch(t){return""}},e.Hook=function(e,t,n){var o=e[t];return e[t]=function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];n(t),o.apply(e,t)},o},e.CreateCookie=function(e,t,n){var o;if(n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),o="; expires="+i.toUTCString()}else o="";document.cookie=e+"="+t+o+"; path=/"},e.ReadCookie=function(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var i=n[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return""},e.CreateGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})},e.RemoveEmpties=function(e){for(var t=e.length,n=t-1;n>=0;n--)e[n]||(e.splice(n,1),t--);return t},e.AddClass=function(t,n){if(t.classList){if(n.indexOf(" ")<0)t.classList.add(n);else{var o=n.split(" ");e.RemoveEmpties(o);for(var i=0,r=o.length;r>i;i++)t.classList.add(o[i])}return t}var s,a=t.className,l=a.split(" "),d=e.RemoveEmpties(l);if(n.indexOf(" ")>=0){for(o=n.split(" "),e.RemoveEmpties(o),i=0;d>i;i++){var c=o.indexOf(l[i]);c>=0&&o.splice(c,1)}o.length>0&&(s=o.join(" "))}else{var u=!1;for(i=0;d>i;i++)if(l[i]===n){u=!0;break}u||(s=n)}return s&&(t.className=d>0&&l[0].length>0?a+" "+s:s),t},e.RemoveClass=function(t,n){if(t.classList){if(0===t.classList.length)return t;var o=n.split(" ");e.RemoveEmpties(o);for(var i=0,r=o.length;r>i;i++)t.classList.remove(o[i]);return t}var s=t.className;if(n.indexOf(" ")>=0)o=n.split(" "),e.RemoveEmpties(o);else{if(s.indexOf(n)<0)return t;o=[n]}var a,l=s.split(" "),d=e.RemoveEmpties(l);for(i=d-1;i>=0;i--)o.indexOf(l[i])>=0&&(l.splice(i,1),a=!0);return a&&(t.className=l.join(" ")),t},e.ToggleClass=function(t,n){t.className.match(n)?e.RemoveClass(t,n):e.AddClass(t,n)},e}();e.Tools=t;var n=function(){function e(e,t,n,o){this.childs=[],e&&(this.element=document.createElement(e),t&&(this.element.className=t),n&&n.appendChild(this.element),this.parent=o,o&&o.childs.push(this))}return e.for=function(t){var n=new e(null);return n.element=t,n},e.prototype.addClass=function(e){return this.element.classList.add(e),this},e.prototype.className=function(e){return this.element.className=e,this},e.prototype.opacity=function(e){return this.element.style.opacity=e,this},e.prototype.display=function(e){return this.element.style.display=e,this},e.prototype.hide=function(){return this.element.style.display="none",this},e.prototype.visibility=function(e){return this.element.style.visibility=e,this},e.prototype.text=function(e){return this.element.textContent=e,this},e.prototype.html=function(e){return this.element.innerHTML=e,this},e.prototype.attr=function(e,t){return this.element.setAttribute(e,t),this},e.prototype.editable=function(e){return this.element.contentEditable=e?"true":"false",this},e.prototype.style=function(e,t){return this.element.style[e]=t,this},e.prototype.appendTo=function(e){return e.appendChild(this.element),this},e.prototype.append=function(t,n,o){var i=new e(t,n,this.element,this);return o&&o(i),this},e.prototype.createChild=function(t,n){var o=new e(t,n,this.element,this);return o},e.prototype.click=function(e){return this.element.addEventListener("click",e),this},e.prototype.blur=function(e){return this.element.addEventListener("blur",e),this},e.prototype.keydown=function(e){return this.element.addEventListener("keydown",e),this},e}();e.FluentDOM=n}(VORLON||(VORLON={}));var VORLON;!function(e){!function(e){e[e.Client=0]="Client",e[e.Dashboard=1]="Dashboard",e[e.Both=2]="Both"}(e.RuntimeSide||(e.RuntimeSide={}));e.RuntimeSide;!function(e){e[e.OneOne=0]="OneOne",e[e.MulticastReceiveOnly=1]="MulticastReceiveOnly",e[e.Multicast=2]="Multicast"}(e.PluginType||(e.PluginType={}));e.PluginType}(VORLON||(VORLON={}));var VORLON;!function(e){var t=function(){function t(t){this.name=t,this._ready=!0,this._id="",this._type=0,this.traceLog=function(e){console.log(e)},this.traceNoop=function(){},this.loadingDirectory="vorlon/plugins",this.debug=e.Core.debug}return Object.defineProperty(t.prototype,"Type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,this.trace=e?this.traceLog:this.traceNoop},enumerable:!0,configurable:!0}),t.prototype.getID=function(){return this._id},t.prototype.isReady=function(){return this._ready},t}();e.BasePlugin=t}(VORLON||(VORLON={}));var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},VORLON;!function(e){var t=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.startClientSide=function(){},n.prototype.onRealtimeMessageReceivedFromDashboardSide=function(){},n.prototype.sendToDashboard=function(t,n){void 0===n&&(n=!1),e.Core.Messenger&&e.Core.Messenger.sendRealtimeMessage(this.getID(),t,0,"message",n)},n.prototype.sendCommandToDashboard=function(t,n,o){void 0===n&&(n=null),void 0===o&&(o=!1),e.Core.Messenger&&(this.trace(this.getID()+" send command to dashboard "+t),e.Core.Messenger.sendRealtimeMessage(this.getID(),n,0,"message",o,t))},n.prototype.refresh=function(){console.error("Please override plugin.refresh()")},n.prototype._loadNewScriptAsync=function(e,t){var n="";n=0===this.loadingDirectory.indexOf("http")?this.loadingDirectory+"/"+this.name+"/":"/"+this.loadingDirectory+"/"+this.name+"/";var o=document.createElement("script");o.setAttribute("src",n+e),o.onload=t;var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(o,i)},n}(e.BasePlugin);e.ClientPlugin=t}(VORLON||(VORLON={}));var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},VORLON;!function(e){var t=function(t){function n(n,o,i){t.call(this,n),this.htmlFragmentUrl=o,this.cssStyleSheetUrl=i,this.debug=e.Core.debug}return __extends(n,t),n.prototype.startDashboardSide=function(){},n.prototype.onRealtimeMessageReceivedFromClientSide=function(){},n.prototype.sendToClient=function(t){e.Core.Messenger&&e.Core.Messenger.sendRealtimeMessage(this.getID(),t,1,"message")},n.prototype.sendCommandToClient=function(t,n,o){void 0===n&&(n=null),void 0===o&&(o=!1),e.Core.Messenger&&(this.trace(this.getID()+" send command to client "+t),e.Core.Messenger.sendRealtimeMessage(this.getID(),n,1,"message",o,t))},n.prototype.sendCommandToPluginClient=function(t,n,o,i){void 0===o&&(o=null),void 0===i&&(i=!1),e.Core.Messenger&&(this.trace(this.getID()+" send command to plugin client "+n),e.Core.Messenger.sendRealtimeMessage(t,o,1,"protocol",i,n))},n.prototype.sendCommandToPluginDashboard=function(t,n,o,i){void 0===o&&(o=null),void 0===i&&(i=!1),e.Core.Messenger&&(this.trace(this.getID()+" send command to plugin dashboard "+n),e.Core.Messenger.sendRealtimeMessage(t,o,0,"protocol",i,n))},n.prototype._insertHtmlContentAsync=function(e,t){var n=this,o="/"+this.loadingDirectory+"/"+this.name+"/",i=!1;e||(e=document.createElement("div"),document.body.appendChild(e),i=!0);var r=new XMLHttpRequest;r.open("GET",o+this.htmlFragmentUrl,!0),r.onreadystatechange=function(){if(4===r.readyState){if(200!==r.status)throw new Error("Error status: "+r.status+" - Unable to load "+o+n.htmlFragmentUrl);e.innerHTML=n._stripContent(r.responseText);var s=document.getElementsByTagName("head")[0],a=document.createElement("link");a.type="text/css",a.rel="stylesheet",a.href=o+n.cssStyleSheetUrl,a.media="screen",s.appendChild(a);var l=e.children[0];i&&(l.className="alone"),t(l)}},r.send(null)},n.prototype._stripContent=function(e){var t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im;if(e){e=e.replace(t,"");var o=e.match(n);o&&(e=o[1])}return e},n}(e.BasePlugin);e.DashboardPlugin=t}(VORLON||(VORLON={}));var VORLON;!function(e){var t=function(){function t(t,n,o,i,r){var s=this;switch(this._isConnected=!1,this._isConnected=!1,this._sessionId=o,this._clientId=i,e.Core._listenClientId=r,this._serverUrl=n,this._waitingEvents=0,t){case 0:this._socket=io.connect(n),this._isConnected=!0;break;case 1:this._socket=io.connect(n+"/dashboard"),this._isConnected=!0}if(this.isConnected){var a=io.Manager(n);a.on("connect_error",function(e){s.onError&&s.onError(e)}),this._socket.on("message",function(e){var t=JSON.parse(e);s.onRealtimeMessageReceived&&s.onRealtimeMessageReceived(t)}),this._socket.on("helo",function(t){e.Core._listenClientId=t,s.onHeloReceived&&s.onHeloReceived(t)}),this._socket.on("identify",function(e){s.onIdentifyReceived&&s.onIdentifyReceived(e)}),this._socket.on("stoplisten",function(){s.onStopListenReceived&&s.onStopListenReceived()}),this._socket.on("waitingevents",function(e){if(s.onWaitingEventsReceived){var t=JSON.parse(e);s.onWaitingEventsReceived(t)}}),this._socket.on("refreshclients",function(){s.onRefreshClients&&s.onRefreshClients()})}}return Object.defineProperty(t.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientId",{set:function(e){this._clientId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"socketId",{get:function(){return this._socket.id},enumerable:!0,configurable:!0}),t.prototype.sendWaitingEvents=function(t,n){var o={metadata:{pluginID:t,side:0,sessionId:this._sessionId,clientId:this._clientId,listenClientId:e.Core._listenClientId,waitingEvents:n}};if(this.isConnected){var i=JSON.stringify(o);this._socket.emit("waitingevents",i)}},t.prototype.sendRealtimeMessage=function(t,n,o,i,r,s){void 0===i&&(i="message"),void 0===r&&(r=!1);var a={metadata:{pluginID:t,side:o,sessionId:this._sessionId,clientId:this._clientId,listenClientId:e.Core._listenClientId},data:n};if(s&&(a.command=s),!this.isConnected)return this.onRealtimeMessageReceived&&this.onRealtimeMessageReceived(a),void 0;if(""===e.Core._listenClientId&&"message"===i)r&&(this._waitingEvents++,this.sendWaitingEvents(t,this._waitingEvents));else{var l=JSON.stringify(a);this._socket.emit(i,l),this._waitingEvents=0,this.sendWaitingEvents(t,0)}},t.prototype.sendMonitoringMessage=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&200===n.status},n.open("POST",this._serverUrl+"api/push"),n.setRequestHeader("Content-type","application/json;charset=UTF-8");var o=JSON.stringify({_idsession:this._sessionId,id:e,message:t});n.send(o)},t.prototype.getMonitoringMessage=function(e,t,n,o){void 0===n&&(n="-20"),void 0===o&&(o="-1");var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState?200===i.status?t&&t(JSON.parse(i.responseText)):t&&t(null):t&&t(null)},i.open("GET",this._serverUrl+"api/range/"+this._sessionId+"/"+e+"/"+n+"/"+o),i.send()},t}();e.ClientMessenger=t}(VORLON||(VORLON={}));var VORLON;!function(e){var t=function(){function t(){this._clientPlugins=new Array,this._dashboardPlugins=new Array,this._socketIOWaitCount=0,this.debug=!1,this._RetryTimeout=1002}return Object.defineProperty(t.prototype,"Messenger",{get:function(){return e.Core._messenger},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ClientPlugins",{get:function(){return e.Core._clientPlugins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DashboardPlugins",{get:function(){return e.Core._dashboardPlugins},enumerable:!0,configurable:!0}),t.prototype.RegisterClientPlugin=function(t){e.Core._clientPlugins.push(t)},t.prototype.RegisterDashboardPlugin=function(t){e.Core._dashboardPlugins.push(t)},t.prototype.StartClientSide=function(t,n,o){var i=this;if(void 0===t&&(t="'http://localhost:1337/'"),void 0===n&&(n=""),void 0===o&&(o=""),e.Core._side=0,e.Core._sessionID=n,e.Core._listenClientId=o,void 0===window.io)return this._socketIOWaitCount<10?(this._socketIOWaitCount++,setTimeout(function(){console.log("Vorlon.js: waiting for socket.io to load..."),e.Core.StartClientSide(t,n,o)},1e3)):(console.log("Vorlon.js: please load socket.io before referencing vorlon.js or use includeSocketIO = true in your catalog.json file."),e.Core.ShowError("Vorlon.js: please load socket.io before referencing vorlon.js or use includeSocketIO = true in your catalog.json file.",0)),void 0;var r=e.Tools.ReadCookie("vorlonJS_clientId");r||(r=e.Tools.CreateGUID(),e.Tools.CreateCookie("vorlonJS_clientId",r,1)),e.Core._messenger=new e.ClientMessenger(e.Core._side,t,n,r,o),e.Core.Messenger.onRealtimeMessageReceived=e.Core._Dispatch,e.Core.Messenger.onHeloReceived=e.Core._OnIdentificationReceived,e.Core.Messenger.onIdentifyReceived=e.Core._OnIdentifyReceived,e.Core.Messenger.onStopListenReceived=e.Core._OnStopListenReceived,e.Core.Messenger.onError=e.Core._OnError;var s={ua:navigator.userAgent};e.Core.Messenger.sendRealtimeMessage("",s,e.Core._side,"helo");for(var a=0;a<e.Core._clientPlugins.length;a++){var l=e.Core._clientPlugins[a];l.startClientSide()}window.addEventListener("beforeunload",function(){e.Core.Messenger.sendRealtimeMessage("",{socketid:e.Core.Messenger.socketId},e.Core._side,"clientclosed")},!1),setTimeout(function(){i.startClientDirtyCheck()},500)},t.prototype.startClientDirtyCheck=function(){var t=window.MutationObserver||window.WebKitMutationObserver||null;if(t){document.body.__vorlon||(document.body.__vorlon={});var n={attributes:!0,childList:!0,subtree:!0,characterData:!0};document.body.__vorlon._observerMutationObserver=new t(function(t){var n=!1;t.forEach(function(t){t.target&&t.target.__vorlon&&t.target.__vorlon.ignore||(t.target&&!n&&t.target.__vorlon&&t.target.parentNode&&t.target.parentNode.__vorlon&&t.target.parentNode.__vorlon.internalId&&setTimeout(function(){var n=null;t&&t.target&&t.target.parentNode&&t.target.parentNode.__vorlon&&t.target.parentNode.__vorlon.internalId&&(n=t.target.parentNode.__vorlon.internalId),e.Core.Messenger.sendRealtimeMessage("ALL_PLUGINS",{type:"contentchanged",internalId:n},e.Core._side,"message")},300),n=!0)})}),document.body.__vorlon._observerMutationObserver.observe(document.body,n)}else{console.log("dirty check using html string");var o;document.body&&(o=document.body.innerHTML),setInterval(function(){var t=document.body.innerHTML;o!=t&&(o=t,e.Core.Messenger.sendRealtimeMessage("ALL_PLUGINS",{type:"contentchanged"},e.Core._side,"message"))},2e3)}},t.prototype.StartDashboardSide=function(t,n,o,i){if(void 0===t&&(t="'http://localhost:1337/'"),void 0===n&&(n=""),void 0===o&&(o=""),void 0===i&&(i=null),e.Core._side=1,e.Core._sessionID=n,e.Core._listenClientId=o,e.Core._errorNotifier=document.createElement("x-notify"),e.Core._errorNotifier.setAttribute("type","error"),e.Core._errorNotifier.setAttribute("position","top"),e.Core._errorNotifier.setAttribute("duration",5e3),e.Core._messageNotifier=document.createElement("x-notify"),e.Core._messageNotifier.setAttribute("position","top"),e.Core._messageNotifier.setAttribute("duration",4e3),document.body.appendChild(e.Core._errorNotifier),document.body.appendChild(e.Core._messageNotifier),void 0===window.io)return this._socketIOWaitCount<10?(this._socketIOWaitCount++,setTimeout(function(){console.log("Vorlon.js: waiting for socket.io to load..."),e.Core.StartDashboardSide(t,n,o,i)},1e3)):(console.log("Vorlon.js: please load socket.io before referencing vorlon.js or use includeSocketIO = true in your catalog.json file."),e.Core.ShowError("Vorlon.js: please load socket.io before referencing vorlon.js or use includeSocketIO = true in your catalog.json file.",0)),void 0;var r=e.Tools.ReadCookie("vorlonJS_clientId");r||(r=e.Tools.CreateGUID(),e.Tools.CreateCookie("vorlonJS_clientId",r,1)),e.Core._messenger=new e.ClientMessenger(e.Core._side,t,n,r,o),e.Core.Messenger.onRealtimeMessageReceived=e.Core._Dispatch,e.Core.Messenger.onHeloReceived=e.Core._OnIdentificationReceived,e.Core.Messenger.onIdentifyReceived=e.Core._OnIdentifyReceived,e.Core.Messenger.onStopListenReceived=e.Core._OnStopListenReceived,e.Core.Messenger.onError=e.Core._OnError;var s={ua:navigator.userAgent};e.Core.Messenger.sendRealtimeMessage("",s,e.Core._side,"helo");for(var a=0;a<e.Core._dashboardPlugins.length;a++){var l=e.Core._dashboardPlugins[a];l.startDashboardSide(i?i(l.getID()):null)}},t.prototype._OnStopListenReceived=function(){e.Core._listenClientId=""},t.prototype._OnIdentifyReceived=function(t){if(1===e.Core._side)e.Core._messageNotifier.innerHTML=t,e.Core._messageNotifier.show();else{var n=document.createElement("div");n.style.position="absolute",n.style.left="0",n.style.top="50%",n.style.marginTop="-150px",n.style.width="100%",n.style.height="300px",n.style.fontFamily="Arial",n.style.fontSize="300px",n.style.textAlign="center",n.style.color="white",n.style.textShadow="2px 2px 5px black",n.style.zIndex="100",n.innerHTML=t,document.body.appendChild(n),setTimeout(function(){document.body.removeChild(n)},4e3)}},t.prototype.ShowError=function(t,n){if(void 0===n&&(n=5e3),1===e.Core._side)e.Core._errorNotifier.innerHTML=t,e.Core._errorNotifier.setAttribute("duration",n),e.Core._errorNotifier.show();else{var o=document.createElement("div");o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100px",o.style.backgroundColor="red",o.style.textAlign="center",o.style.fontSize="30px",o.style.paddingTop="20px",o.style.color="white",o.style.fontFamily="consolas",o.style.zIndex="1001",o.innerHTML=t,document.body.appendChild(o),n&&setTimeout(function(){document.body.removeChild(o)},n)}},t.prototype._OnError=function(t){e.Core.ShowError("Error while connecting to server. Server may be offline.<BR>Error message: "+t.message)},t.prototype._OnIdentificationReceived=function(t){if(e.Core._listenClientId=t,0===e.Core._side)for(var n=0;n<e.Core._clientPlugins.length;n++){var o=e.Core._clientPlugins[n];o.refresh()}else{var i=document.querySelector(".dashboard-plugins-overlay");e.Tools.AddClass(i,"hidden")}},t.prototype._RetrySendingRealtimeMessage=function(t,n){setTimeout(function(){return t.isReady()?(e.Core._DispatchFromClientPluginMessage(t,n),void 0):(e.Core._RetrySendingRealtimeMessage(t,n),void 0)},e.Core._RetryTimeout)},t.prototype._Dispatch=function(t){return t.metadata?("ALL_PLUGINS"==t.metadata.pluginID?(e.Core._clientPlugins.forEach(function(n){e.Core._DispatchPluginMessage(n,t)}),e.Core._dashboardPlugins.forEach(function(n){e.Core._DispatchPluginMessage(n,t)})):(e.Core._clientPlugins.forEach(function(n){return n.getID()===t.metadata.pluginID?(e.Core._DispatchPluginMessage(n,t),void 0):void 0}),e.Core._dashboardPlugins.forEach(function(n){return n.getID()===t.metadata.pluginID?(e.Core._DispatchPluginMessage(n,t),void 0):void 0})),void 0):(console.error("invalid message "+JSON.stringify(t)),void 0)},t.prototype._DispatchPluginMessage=function(t,n){t.trace("received "+JSON.stringify(n)),0===n.metadata.side?t.isReady()?e.Core._DispatchFromClientPluginMessage(t,n):e.Core._RetrySendingRealtimeMessage(t,n):e.Core._DispatchFromDashboardPluginMessage(t,n)},t.prototype._DispatchFromClientPluginMessage=function(e,t){if(t.command&&e.DashboardCommands){var n=e.DashboardCommands[t.command];if(n)return n.call(e,t.data),void 0}e.onRealtimeMessageReceivedFromClientSide(t.data)},t.prototype._DispatchFromDashboardPluginMessage=function(e,t){if(t.command&&e.ClientCommands){var n=e.ClientCommands[t.command];if(n)return n.call(e,t.data),void 0}e.onRealtimeMessageReceivedFromDashboardSide(t.data)},t}();e._Core=t,e.Core=new t}(VORLON||(VORLON={}));